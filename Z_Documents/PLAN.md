「世界一シンプルな筋トレ記録アプリ」をFree/Proの収益化モデルで実装します。
実装がブレないよう、まず仕様（P0/P1/P2）をコードに落とし込める形で確定し、次に設計と実装タスクに分解してください。

# 収益化モデル（価格：確定）
- Pro 月額：¥250
- Pro 年額：¥2,500
- 広告なし
- Free/Proの差は「保存量」ではなく「見返し・分析・カスタマイズ」体験の差で作る

# 前提
- アプリはiOS/Android対応。ローカル保存（オフライン）を基本とする。
- “世界一シンプル”思想を最優先：記録導線を重くしない。
- 既存機能：Home / WorkoutInput / Settings / Timer（ミニ表示＋拡大）/ 前回記録（表示・コピー・再現）
- 状態管理：Riverpod（既存に合わせる）
- DB：sqflite等（既存に合わせる）
- Web(Chrome)ではDBが動かない場合があるため、iOS/Android前提でOK

# 収益化の機能境界（確定）
## P0（無料）
### 重要方針：保存は無制限（全ユーザー共通）
- ワークアウト記録データはFree/Proともに「無制限に保存」する（削除・自動消去しない）
- Free/Proの差は「閲覧できる範囲」「分析機能」「カスタマイズ」に限定する（ユーザー資産を奪わない）

### 無料で提供する機能（体験の核）
- 記録（部位→種目→セット：重量/回数）
- 前回記録：直近completedの同一種目を表示
- 前回を再現（全セット複製）
- 前回値コピー（セット単位）
- タイマー（ミニ表示＋拡大）＋終了通知
- 単位切替（kg/lb）＋自動換算
- 言語切替（英/日）
- ローカル保存＋記録中セッション復帰

### Freeの閲覧制限（ここが課金ポイント）
- 履歴の「詳細閲覧」は直近20セッションまで（セッション＝completedワークアウト単位）
  - 直近20より古いセッションは「存在は見える」が、詳細はロック（Pro誘導）
  - 例：日付と種目数などのサマリだけ表示し、タップでPaywall
- 種目別履歴の深掘り（検索・フィルタ・過去遡り）は不可/制限
- グラフなし
- 統計は簡易（今月の回数/継続日数など最低限）
- テーマ/カラー変更なし（デフォルトテーマ固定）

## P1（有料Pro：最優先）
- 履歴の無制限「詳細閲覧」解放（Freeの直近20制限解除）
- 種目別の成長グラフ（重量/回数/推定1RMの推移）
- 種目検索＋フィルタで過去ログ閲覧を高速化（過去遡りも含めて制限解除）
- 月/週統計（部位別頻度、総セット数など）
- （余裕あれば）CSVエクスポート

### 追加：Proテーマカスタマイズ（確定）
- アプリ全体の配色をユーザーが変更できる（Proのみ）
  - 変更対象：メインカラー / サブカラー / 文字色（onPrimary相当）/ 背景（任意）
  - テンプレテーマ（プリセット）を複数用意しワンタップ適用
  - 「カスタム」モード：カラーコード（#RRGGBB / #AARRGGBB）自由入力
  - バリデーション（不正hexは弾く）
  - 視認性ガード：コントラスト不足は警告 or 自動補正（最小実装でOK）
  - 設定画面内プレビュー（入力画面のUXは壊さない）
  - ローカル永続化
  - 変更はアプリ全体に即反映

- 無料ユーザーがテーマ変更UIに触れた場合は「Proで解放」導線（簡潔なPaywall/モーダル）

## P2（後回し）
- クラウド同期/バックアップ/復元、目標・リマインド、テンプレ等（このフェーズでは触らない）

# 課金導線（最小でシンプル）
- Pro誘導トリガー（やりすぎないが、確実に当たる導線）
  1) 直近20セッションより古い「詳細を開こうとした瞬間」
  2) グラフを開こうとした瞬間
  3) テーマカスタマイズを適用/編集しようとした瞬間
- Paywallは“1画面”、比較表は“3行”まで（世界一シンプルを壊さない）
- 入力画面（WorkoutInput）には課金UIを挿入しない（UX最優先）
- 価格表示は上記確定価格（¥250/月、¥2,500/年）を前提にUI文言を用意

# Pro誘導UX（必須：ユーザーが自分から入りたくなる導線）
- Freeユーザーには「詳細閲覧できる履歴は直近20セッションまで」という制限を明確に伝える。
- ただし“保存は無制限”であることも同時に伝え、「記録が消える不安」は与えない。
- 直近20より古いセッションの一覧行は表示し、タップ可能にする（＝興味を持った瞬間に自然に誘導）。
  - タップ時にPaywallを表示し、以下の文言を必ず表示する（短く、押し付けない、でも価値が伝わる）。

## ロック行（履歴一覧上）に表示する短文（日本語）
- ラベル例：『Proで全履歴を表示』
- 補足例：『無料版は直近20回まで。過去の成長を全部見返すにはProへ』

## ロック行（履歴一覧上）に表示する短文（英語）
- Label: 'Unlock full history with Pro'
- Sub: 'Free shows the latest 20 sessions. Go Pro to view everything.'

## Paywall表示時のメッセージ（日本語：候補）
- タイトル：『過去の記録をすべて見返す』
- 本文：『無料版は直近20回まで表示できます。Proなら全履歴・グラフ・統計で成長がもっと見えるようになります。』
- CTA：『Proを試す』
- サブCTA：『今はしない』

## Paywall表示時のメッセージ（英語：候補）
- Title: 'View your full history'
- Body: 'Free shows your latest 20 sessions. Go Pro to unlock full history, charts, and stats to see your progress.'
- CTA: 'Try Pro'
- Secondary: 'Not now'

## 導線の実装要件（必須）
- 誘導は「ユーザーが欲しい瞬間（古い履歴を開く/グラフを見る/テーマを変える）」にだけ出す。
- WorkoutInput（記録入力画面）の最中は邪魔しない（課金UIを挿入しない）。
- Paywallは共通コンポーネント1つに集約し、reason（history_locked / chart / theme）に応じて文言だけ切り替える。

# やってほしいこと（アウトプット形式）
1) Free/Proの境界を破綻なく実装するための「仕様の文章化（要件定義）」を出す
   - “直近20セッション”の定義（並び順、対象ステータス、削除時の扱い）
   - 「古いセッションの見せ方（サマリは見せる/詳細はロック）」のUX
   - Pro誘導トリガーと表示メッセージ（短く、世界一シンプルを保つ）
   - テーマカスタマイズ仕様（プリセット管理、カスタム入力、バリデーション、コントラストガード、永続化）
2) 実装設計
   - “課金状態”を表すドメインモデル（例：Entitlement: free/pro）
   - UI上のゲート方法（route guard / feature flag / UI disabled などの適用方針）
   - 履歴閲覧制限の実装（クエリ/並び替え/ロック判定）
   - テーマ管理の設計（ThemeData生成、ColorScheme、Riverpodでの状態保持、永続化ストレージ）
   - Paywallの最小仕様（1画面、3行比較、価格表示）
3) 実装タスクリスト（ファイル単位、順番付き）
4) 可能なら、コードスケルトンを提示
   - Entitlement provider（スタブ→IAP差し替え可能）
   - Feature gate helper（canAccessX系）
   - History lock判定ロジック
   - Theme settings model & provider
   - ThemeData生成関数（preset + custom）
   - hex parser + validation
   - contrast guard（最小）
   - Settings画面に「Theme」セクション（Proゲート＋プレビュー）
   - Paywall（共通コンポーネント：理由を引数に取る）

# 実装方針（重要）
- IAP（in_app_purchase等）の接続はP1の最後。まずはスタブでPro状態を切り替え可能にし、UI/永続化/ゲートを完成させる。
- 最小diffで追加し、テスト可能な単位でコミットできる構成にする。
- “保存は無制限”を厳守し、Free側は「見返しの深さ」で制限する。
- 既存の見た目を大きく変えずに、テーマが適用される設計にする（colorScheme中心）。