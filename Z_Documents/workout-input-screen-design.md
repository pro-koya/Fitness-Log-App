# トレーニング記録入力画面：基本設計書

## 1. 画面の目的

### 主目的
- 部位・種目・セット（重量×回数）を **5秒以内/1セット** で入力できる
- 前回記録と比較しながら、迷わず記録を進められる
- タイマーと統合し、アプリ単独でトレーニングを完結させる

### 成功指標
- ホーム→記録開始が **2タップ以内**
- 1セット（重量・回数）の入力が **5秒以内**
- 前回の値を **1タップでコピー** できる
- 片手（親指）で **迷わず操作** できる

---

## 2. レイアウト構成

### 全体構造（親指ゾーン最適化）

```
┌─────────────────────────────┐
│ ヘッダー（固定）              │ ← 情報表示のみ
├─────────────────────────────┤
│                             │
│  種目カードリスト             │ ← スクロール可能
│  （Exercise Cards）          │
│                             │
│                             │
│                             │
├─────────────────────────────┤
│ アクションバー（固定）         │ ← 親指ゾーン
│ [種目追加] [完了]            │
└─────────────────────────────┘
  [Timer Mini]  ← フローティング
```

### なぜこの構成か
- **上部（ヘッダー）**: 情報表示のみで、親指が届きにくいため操作要素は置かない
- **中央（種目カードリスト）**: スクロールして複数種目を管理、セット入力はここで完結
- **下部（アクションバー）**: 親指ゾーンの中心で、最も重要な操作（種目追加、完了）を配置
- **タイマー**: フローティング表示で邪魔にならず、常時確認可能

---

## 3. 固定表示要素とスクロール要素

### 固定表示（画面遷移・スクロールしても常に表示）
1. **ヘッダー**
   - セッション開始時刻（例：14:32〜）
   - 戻るボタン（左上）
   - 設定ボタン（右上、任意）

2. **アクションバー（画面下部）**
   - 種目追加ボタン（Primary CTA）
   - 完了ボタン（Secondary CTA）

3. **タイマーミニ表示（フローティング）**
   - 画面右下に常時表示
   - セット入力エリアと重ならない位置

### スクロール要素
- **種目カードリスト**
  - 複数種目を縦スクロールで表示
  - 各種目カードは独立したセット入力エリアを持つ

### なぜこの分割か
- **固定要素**: ユーザーが「次に何をすべきか」を常に把握できる（迷わない）
- **スクロール要素**: 複数種目を扱えるが、操作対象は常に画面内に収まる（スクロールしながら入力しない）

---

## 4. 種目カードの構造

### 種目カード全体レイアウト

```
┌─────────────────────────────────────┐
│ 種目名                      [削除]   │
│ ベンチプレス                         │
├─────────────────────────────────────┤
│ 前回： 40kg×10 / 40kg×10 / 35kg×12  │ ← 前回記録表示
│                      [前回を再現]     │ ← 全セット複製
├─────────────────────────────────────┤
│ セット1  [40] kg  [10] reps  [コピー]│ ← セット行
│ セット2  [40] kg  [10] reps  [コピー]│
│ セット3  [  ] kg  [  ] reps  [コピー]│
│                      [+ セット追加]   │
└─────────────────────────────────────┘
```

### 構成要素
1. **種目名 + 削除ボタン**
   - 種目名：大きめのフォント（16pt）で視認性確保
   - 削除ボタン：右上に配置（誤タップ防止のため小さめ）

2. **前回記録表示エリア**
   - 前回のセット一覧（例：40kg×10 / 40kg×10 / 35kg×12）
   - 前回記録がない場合：「—」表示
   - 「前回を再現」ボタン：全セットを一括コピー

3. **セットリスト**
   - セット行を縦に並べる
   - 最初は1セット目のみ表示
   - 「+セット追加」ボタンで2セット目以降を追加

4. **セット追加ボタン**
   - セットリストの下に配置
   - タップでセット行を追加

### なぜこの構造か
- **前回記録を上部に配置**: セット入力前に必ず目に入る位置で、比較が容易
- **前回を再現ボタン**: 全セットを一括コピーする最速の方法（ワンタップで完了）
- **セット行を縦に並べる**: 親指で上下スクロールしながら入力できる

---

## 5. セット行のUI仕様

### セット行レイアウト（最重要：5秒以内入力の核心）

```
┌──────────────────────────────────────────┐
│ Set 1  [40] kg  [10] reps  [📋] [×]      │
└──────────────────────────────────────────┘
```

### 構成要素
1. **セット番号**
   - 左端に固定表示（例：Set 1）
   - フォントサイズ：14pt、グレー色（目立たせない）

2. **重量入力フィールド**
   - 幅：60pt（3桁まで入力可能）
   - 数値キーボード自動表示
   - 単位（kg/lb）は右に小さく表示

3. **回数入力フィールド**
   - 幅：50pt（2桁まで入力可能）
   - 数値キーボード自動表示
   - 単位（reps）は右に小さく表示

4. **コピーボタン（📋）**
   - 前回の同セット番号の値をコピー
   - 前回記録がない場合は無効化（グレーアウト）
   - アイコン：クリップボードまたはコピーアイコン

5. **削除ボタン（×）**
   - セット行を削除
   - 1セット目は削除不可（最低1セットは必須）
   - タップで削除確認ダイアログ表示

### 入力フィールドの仕様
- **タップで即座に数値キーボード表示**
- **フォーカス時にフィールド全体をハイライト**（現在入力中が明確）
- **Enter/完了キーで次のフィールドへ自動遷移**（重量→回数→次セット）
- **初期値は空欄**（前回コピーまたは手動入力）

### なぜこの仕様か
- **入力フィールドを大きく**: 親指でタップしやすい（最低44pt推奨）
- **数値キーボード自動表示**: 余計なタップを削減（1タップで入力開始）
- **コピーボタンを右に配置**: 親指で自然にタップできる位置
- **削除ボタンは控えめ**: 誤タップ防止（使用頻度が低いため小さめ）

---

## 6. 前回記録の表示・コピー仕様

### 前回記録の定義
- **「前回」とは**: 同一種目（exercise）の直近の完了（completed）セッションにおける記録
- 記録中（in_progress）のデータは参照しない（前回がブレないため）

### 前回記録表示エリア

```
┌─────────────────────────────────────┐
│ 前回： 40kg×10 / 40kg×10 / 35kg×12  │
│                      [前回を再現]     │
└─────────────────────────────────────┘
```

### 表示仕様
- **フォーマット**: `重量kg×回数 / 重量kg×回数 / ...`
- **セット数が多い場合**: 先頭3セット＋"..."で省略（タップで全展開は任意、P1）
- **前回記録がない場合**: `前回： —`（初回体験の破綻防止）
- **単位変換**: ユーザー設定の単位（kg/lb）に自動変換して表示

### コピー仕様

#### A. セット単位コピー（セット行の📋ボタン）
- **動作**: 前回のNセット目の値（重量・回数）を、今日のNセット目にコピー
- **前回にNセット目が存在しない場合**: 前回の最終セットをコピー
- **単位が異なる場合**: 自動変換してコピー（例：前回がlb、今回がkgなら自動変換）

#### B. 全セット一括コピー（前回を再現ボタン）
- **動作**: 前回の全セット（セット数・重量・回数）をワンタップで複製
- **既存のセットがある場合**: 確認ダイアログ表示（上書き確認）
- **前回記録がない場合**: ボタンを無効化（グレーアウト）

### なぜこの仕様か
- **前回を常に表示**: ユーザーが「前回より伸ばせたか」を即座に判断できる
- **セット単位コピー**: セットごとに微調整したい場合に便利（例：1セット目だけ重量を上げる）
- **全セット一括コピー**: 前回と同じ内容を再現する最速の方法（ワンタップで完了）
- **単位自動変換**: ユーザーが単位を切り替えても、前回記録を正しくコピーできる

---

## 7. タイマーの表示方式

### ミニ表示（常時表示）

```
画面右下にフローティング表示
┌─────────────┐
│   01:23     │ ← 残り時間
│   ⏸️ PAUSE  │ ← 状態
└─────────────┘
```

### ミニ表示の仕様
- **位置**: 画面右下（アクションバーの上、種目カードと重ならない）
- **サイズ**: 80pt × 60pt（小さすぎず、邪魔にならない）
- **表示内容**:
  - 残り時間（例：01:23）
  - 状態（PAUSE / RUNNING）
  - タップで拡大表示
- **常時表示**: セット入力中でも常に見える

### 拡大表示（モーダル）

```
┌─────────────────────────────┐
│         タイマー              │
│                             │
│         02:00               │ ← 大きく表示
│                             │
│   [Start]  [Pause]  [Reset] │
│                             │
│   プリセット（P1）            │
│   [60s] [90s] [120s]        │
│                             │
│         [閉じる]             │
└─────────────────────────────┘
```

### 拡大表示の仕様
- **表示方法**: モーダル（画面全体を覆う）
- **表示内容**:
  - 残り時間（大きく表示：48pt以上）
  - Start / Pause / Reset ボタン
  - プリセット（P1：60s/90s/120s、MVP後に追加検討）
  - 閉じるボタン（モーダルを閉じてミニ表示に戻る）
- **操作**:
  - Start: タイマー開始
  - Pause: 一時停止
  - Reset: リセット
  - 閉じる: ミニ表示に戻る

### タイマー終了通知
- **音**: デフォルトの通知音（OS設定に従う）
- **バイブレーション**: 3回短く振動
- **画面通知**: ミニ表示が点滅（視覚的フィードバック）

### なぜこの仕様か
- **ミニ表示を常時表示**: セット間休憩の残り時間を常に確認でき、記録入力を邪魔しない
- **タップで拡大**: 操作が必要な時だけ拡大し、細かい操作ができる
- **フローティング表示**: 種目カードと重ならず、スクロールしても常に表示される
- **終了通知**: アプリを見ていなくても、セット間休憩の終了に気づける

---

## 8. 状態遷移

### 画面の状態

```
[Home] → [記録開始] → [記録中] → [完了] → [Home]
                          ↓
                      [記録中断]（アプリ終了）
                          ↓
                      [記録再開]（アプリ再起動）
```

### 各状態の定義

#### 1. 未開始
- **定義**: セッションが存在しない状態
- **画面遷移**: この画面には来ない（Homeから「記録開始」で記録中に遷移）

#### 2. 記録中（in_progress）
- **定義**: セッションが存在し、種目・セットを入力中
- **画面表示**:
  - 種目カードリスト（0件以上）
  - 種目追加ボタン（有効）
  - 完了ボタン（有効）
- **操作**:
  - 種目追加: 部位選択→種目選択/自由入力のモーダルを表示
  - セット入力: 重量・回数を入力
  - 前回コピー: 前回の値をコピー
  - 完了: セッションをcompletedにしてHomeに遷移

#### 3. 記録中断（アプリ終了）
- **定義**: 記録中にアプリを終了した状態
- **データ保存**: ローカルにin_progressのセッションとして保存
- **再開時**: Homeに「記録中の続き」ボタンを表示（強調表示）

#### 4. 完了（completed）
- **定義**: 「完了」ボタンを押してセッションを完了した状態
- **画面遷移**: Homeに戻る
- **データ保存**: セッションをcompletedとして保存（次回の「前回記録」として参照可能）

### なぜこの状態遷移か
- **記録中断を許容**: トレーニング中にアプリを閉じても、再開できる（ユーザビリティ向上）
- **完了で明示的に終了**: 記録が確定したことをユーザーに明確に伝える
- **in_progress/completedの区別**: 前回記録がブレないようにする（重要）

---

## 9. 空状態・エラー時の扱い

### 空状態（種目が0件）

```
┌─────────────────────────────┐
│       ヘッダー               │
├─────────────────────────────┤
│                             │
│        💪                   │
│                             │
│   種目を追加して             │
│   トレーニングを開始しよう    │
│                             │
│      ↓                      │
│   [種目を追加]               │ ← 誘導CTA
│                             │
├─────────────────────────────┤
│ [種目追加] [完了]            │
└─────────────────────────────┘
```

### なぜこの表示か
- **初回体験で迷わせない**: 「何をすべきか」を明確に誘導
- **視覚的に分かりやすい**: アイコン＋テキストで直感的に理解できる

---

### エラー時の扱い

#### 1. セット削除の誤操作防止

```
┌─────────────────────────────┐
│   このセットを削除しますか？  │
│                             │
│   Set 2: 40kg × 10reps      │
│                             │
│   [キャンセル]  [削除]       │
└─────────────────────────────┘
```

- **表示タイミング**: セット行の削除ボタン（×）をタップ時
- **確認内容**: 削除するセットの内容を表示
- **操作**: キャンセル（閉じる）/ 削除（実行）

#### なぜ確認ダイアログか
- **誤タップ防止**: セット削除は復元できないため、確認が必要
- **セット内容を表示**: 削除対象を明確にする

---

#### 2. 前回記録がない場合

```
種目カード
┌─────────────────────────────────────┐
│ ベンチプレス                   [削除]│
├─────────────────────────────────────┤
│ 前回： —                            │ ← 前回記録なし
│                [前回を再現]（無効化） │ ← グレーアウト
├─────────────────────────────────────┤
│ セット1  [  ] kg  [  ] reps  [📋]   │ ← コピーボタン無効化
└─────────────────────────────────────┘
```

- **前回表示**: 「—」（ダッシュ）で前回がないことを明示
- **前回を再現ボタン**: グレーアウトで無効化
- **コピーボタン**: グレーアウトで無効化

#### なぜこの表示か
- **初回体験を破綻させない**: 前回がなくても入力できることを明確にする
- **無効化で誤操作防止**: タップしても何も起きないことを視覚的に示す

---

#### 3. 種目削除の確認

```
┌─────────────────────────────┐
│   この種目を削除しますか？    │
│                             │
│   ベンチプレス               │
│   （3セット入力済み）         │
│                             │
│   [キャンセル]  [削除]       │
└─────────────────────────────┘
```

- **表示タイミング**: 種目カードの削除ボタンをタップ時
- **確認内容**: 種目名＋セット数を表示
- **操作**: キャンセル（閉じる）/ 削除（実行）

#### なぜ確認ダイアログか
- **誤タップ防止**: 種目削除は複数セットをまとめて削除するため、影響が大きい
- **セット数を表示**: 削除の影響範囲を明確にする

---

#### 4. 記録完了の確認（任意、検討）

```
┌─────────────────────────────┐
│   トレーニングを完了しますか？│
│                             │
│   3種目、12セット記録済み    │
│                             │
│   [キャンセル]  [完了]       │
└─────────────────────────────┘
```

- **表示タイミング**: 完了ボタンをタップ時（任意、P1で検討）
- **確認内容**: 種目数・セット数を表示
- **操作**: キャンセル（閉じる）/ 完了（セッションをcompletedにしてHomeへ遷移）

#### なぜ確認ダイアログか（任意）
- **誤タップ防止**: 完了後はセッションを編集できないため、確認が望ましい
- **達成感の演出**: 記録した内容を可視化し、達成感を高める

**ただし、MVPでは確認なしでも良い**（速さ優先）。ユーザーテスト後に判断。

---

## 10. 実装時の優先順位（MVP）

### P0（必須）
- レイアウト構成（固定/スクロール要素）
- 種目カードの基本構造
- セット行の入力フィールド（重量・回数）
- 前回記録の表示
- セット単位コピー機能
- 前回を再現機能
- タイマーのミニ表示
- タイマーの拡大表示（Start/Pause/Reset）
- タイマー終了通知
- セット追加/削除機能
- 記録完了機能
- 空状態表示（種目0件）
- セット削除の確認ダイアログ

### P1（あると便利）
- 種目削除の確認ダイアログ
- 記録完了の確認ダイアログ
- 前回セット一覧の省略＋展開
- タイマーのプリセット（60s/90s/120s）

---

## 11. まとめ：なぜこの設計か

### 1. 1セット5秒以内を実現する仕組み
- **数値キーボード自動表示**: タップ→即入力（余計な操作を削減）
- **Enter/完了キーで次フィールドへ自動遷移**: 重量→回数→次セットをスムーズに移動
- **コピーボタンを親指ゾーンに配置**: 前回と同じ値なら1タップで完了
- **入力フィールドを大きく**: タップミスを防ぐ

### 2. 前回記録を1タップでコピーする仕組み
- **セット単位コピー**: 各セット行にコピーボタンを配置（1タップで前回の値をコピー）
- **全セット一括コピー**: 「前回を再現」ボタンで全セットをワンタップ複製
- **単位自動変換**: ユーザーが単位を切り替えても、前回記録を正しくコピー

### 3. タイマーが入力を邪魔しない仕組み
- **ミニ表示を常時表示**: セット間休憩の残り時間を確認しつつ、セット入力も可能
- **フローティング表示**: 種目カードと重ならず、スクロールしても常に表示
- **タップで拡大**: 操作が必要な時だけ拡大し、細かい操作ができる

### 4. 片手操作（親指ゾーン）を実現する仕組み
- **主要アクションは画面下部**: 種目追加、完了ボタンを親指ゾーンに配置
- **コピーボタンは右端**: 右手親指で自然にタップできる位置
- **入力フィールドは大きく**: 最低44pt推奨（タップしやすい）
- **上部は情報表示のみ**: 親指が届きにくいため、操作要素は置かない

---

## 12. 次のステップ

この設計書を基に、以下を実装：
1. **Flutter Widgetの設計**（画面構造の実装）
2. **状態管理の設計**（Riverpod/Blocでのデータフロー）
3. **データモデルの設計**（WorkoutSession、Exercise、SetRecordのモデル定義）
4. **ローカルデータ保存の設計**（Hive/Drift等のDB選定）
5. **i18n対応**（文字列リソース化）

実装可能な粒度で具体化されており、次のステップへ進める準備が整いました。
